// সম্পূর্ণ গল্পের ডাটাবেস
const stories = [
    {
        id: 1,
        title: "চারটি ড্রাগন (The Four Dragons)",
        image: "https://images.unsplash.com/photo-1599739773408-542a17730d1f?q=80&w=800&auto=format&fit=crop", 
        desc: "চীনের চারটি প্রধান নদীর উৎপত্তির পেছনের রোমাঞ্চকর কাহিনী।",
        fullStory: `অনেক অনেক কাল আগে, চীনে কোনো নদী বা হ্রদ ছিল না। ছিল শুধু পূর্ব সাগরের লোনা পানি। সেখানে বাস করত চারটি ড্রাগন—লম্বা ড্রাগন, হলুদ ড্রাগন, কালো ড্রাগন এবং মুক্তা ড্রাগন। একদিন তারা আকাশে খেলতে খেলতে দেখল, নিচে মানুষ খরায় কষ্ট পাচ্ছে। কোনো বৃষ্টি নেই, ফসল শুকিয়ে যাচ্ছে।

ড্রাগনরা মানুষের কষ্ট দেখে ব্যথিত হলো। তারা স্বর্গের সম্রাট 'জেড এম্পায়ার'-এর কাছে বৃষ্টির জন্য প্রার্থনা করতে গেল। সম্রাট বৃষ্টির প্রতিশ্রুতি দিলেও পরে ভুলে গেলেন। দশ দিন পেরিয়ে গেল, এক ফোঁটাও বৃষ্টি হলো না।

মানুষের কান্না সইতে না পেরে ড্রাগনরা নিজেরাই সিদ্ধান্ত নিল। তারা সাগরের পানি মুখে নিয়ে আকাশে উড়ে গেল এবং বৃষ্টির মতো সেই পানি ছিটিয়ে দিল। পৃথিবী আবার সবুজ হয়ে উঠল। কিন্তু সম্রাট যখন জানলেন যে তার অনুমতি ছাড়া ড্রাগনরা বৃষ্টি দিয়েছে, তিনি রেগে গেলেন। তিনি চারটি পাহাড় দিয়ে চারটি ড্রাগনকে বন্দী করার নির্দেশ দিলেন।

বন্দী হয়েও ড্রাগনরা মানুষের উপকারের কথা ভুলল না। তারা নিজেদের শরীরে রূপান্তর ঘটিয়ে চারটি বিশাল নদীতে পরিণত হলো, যাতে মানুষ আর কখনো পানির কষ্টে না ভোগে। এভাবেই সৃষ্টি হলো চীনের চারটি মহান নদী—হেইলংজিয়াং (কালো ড্রাগন), হুয়াংহো (হলুদ ড্রাগন), ইয়াংজি (লম্বা ড্রাগন) এবং ঝুজিরাং (মুক্তা ড্রাগন)।`
    },
    {
        id: 2,
        title: "জাদুকরী তুলি (The Magic Paintbrush)",
        image: "https://images.unsplash.com/photo-1515405295579-ba7f9f92f413?q=80&w=800&auto=format&fit=crop",
        desc: "মা লিয়াং নামের এক গরিব ছেলে ও তার জাদুকরী তুলির গল্প।",
        fullStory: `এক গ্রামে মা লিয়াং নামে এক গরিব এতিম ছেলে থাকত। তার খুব শখ ছিল ছবি আঁকার, কিন্তু তুলি কেনার টাকা ছিল না। সে কাঠক কয়লা দিয়ে দেয়ালে ছবি আঁকত। একদিন রাতে এক বৃদ্ধ সাধু স্বপ্নে তাকে একটি সোনালী তুলি উপহার দিয়ে বললেন, "এটি সাধারণ তুলি নয়, সাবধান থেকো।"

ঘুম থেকে উঠে লিয়াং দেখল সত্যি তার হাতে তুলি! সে খুশিতে একটি পাখির ছবি আঁকল, আর অবাক কাণ্ড—পাখিটি জীবন্ত হয়ে উড়ে গেল! লিয়াং বুঝল এটি জাদুকরী তুলি। এরপর থেকে সে গ্রামের গরিবদের জন্য প্রয়োজনীয় জিনিস আঁকতে লাগল—কারও জন্য লাঙল, কারও জন্য গরু।

এই খবর চলে গেল লোভী সম্রাটের কানে। তিনি লিয়াংকে ধরে এনে বললেন, "আমার জন্য সোনার পাহাড় আঁকো।" লিয়াং রাজি হলো না, কিন্তু সম্রাট তাকে জোর করলেন। লিয়াং তখন একটি বিশাল সমুদ্র আঁকল। সম্রাট বললেন, "সমুদ্রের মাঝে সোনার পাহাড় আঁকো।" লিয়াং তাই করল। 

সম্রাট পাহাড়ে যাওয়ার জন্য একটি বড় জাহাজ আঁকতে বললেন। লিয়াং জাহাজ আঁকল। সম্রাট ও তার মন্ত্রীরা জাহাজে চড়লেন। জাহাজ যখন মাঝসমুদ্রে, লিয়াং তখন তুলি দিয়ে প্রবল ঝড় ও বাতাস আঁকতে শুরু করল। সেই ঝড়ে জাহাজ উল্টে গেল এবং লোভী সম্রাট আর ফিরে এলেন না। এরপর লিয়াং তার গ্রামে ফিরে সুখে শান্তিতে বসবাস করতে লাগল।`
    },
    {
        id: 3,
        title: "মহা প্রাচীরের কান্না (Legend of Meng Jiangnu)",
        image: "https://images.unsplash.com/photo-1508804185872-d7badad00f7d?q=80&w=800&auto=format&fit=crop",
        desc: "ভালবাসার শক্তিতে কীভাবে চীনের মহাপ্রাচীর কেঁপে উঠেছিল।",
        fullStory: `চীনের মহাপ্রাচীর বা 'গ্রেট ওয়াল' তৈরির সময়কার কথা। মেং জিয়াংনু নামের এক সুন্দরী তরুণীর সদ্য বিয়ে হয়েছিল ফ্যান জিলিয়াং নামের এক যুবকের সাথে। কিন্তু বিয়ের মাত্র তিন দিন পরেই সরকারি সৈন্যরা এসে ফ্যানকে ধরে নিয়ে গেল মহাপ্রাচীর নির্মাণের কাজ করার জন্য।

এক বছর পার হয়ে গেল, স্বামীর কোনো খবর নেই। মেং জিয়াংনু সিদ্ধান্ত নিলেন স্বামীর জন্য শীতের পোশাক নিয়ে নিজেই প্রাচীরের কাছে যাবেন। দীর্ঘ পথ পাড়ি দিয়ে তিনি যখন সেখানে পৌঁছালেন, শুনলেন এক দুঃসংবাদ। অত্যধিক পরিশ্রমে তার স্বামী মারা গেছেন এবং তাকে প্রাচীরের নিচেই চাপা দেওয়া হয়েছে।

শোকে পাথর হয়ে গেলেন মেং জিয়াংনু। তিনি প্রাচীরের পাশে বসে দিন-রাত কাঁদতে লাগলেন। তার কান্নার আওয়াজে আকাশ-বাতাস ভারী হয়ে উঠল। হঠাৎ এক প্রচণ্ড শব্দে প্রাচীরের একটি বিশাল অংশ ধসে পড়ল এবং সেখান থেকে তার স্বামীর দেহাবশেষ বেরিয়ে এল।

এই গল্পটি আজও চীনে ভালোবাসার প্রতীক হিসেবে স্মরণ করা হয়। এটি মনে করিয়ে দেয় যে, ভালোবাসার শক্তি পাথরের দেয়ালের চেয়েও বেশি শক্তিশালী।`
    },
    {
        id: 4,
        title: "নিয়ান দানব (The Legend of Nian)",
        image: "https://images.unsplash.com/photo-1528642474493-227698b6c9df?q=80&w=800&auto=format&fit=crop",
        desc: "কেন চাইনিজ নিউ ইয়ারে লাল রঙ এবং আতশবাজি ব্যবহার করা হয়?",
        fullStory: `প্রাচীনকালে 'নিয়ান' নামে এক ভয়ঙ্কর দানব ছিল। সে সমুদ্রের গভীরে বাস করত, কিন্তু প্রতি বছর নববর্ষের আগের রাতে ডাঙায় উঠে আসত। সে গ্রামের পশুপাখি, শস্য এবং এমনকি বাচ্চাদেরও খেয়ে ফেলত। ভয়ে গ্রামবাসীরা এই রাতে পাহাড়ে পালিয়ে যেত।

একবার এক ভিখারি বৃদ্ধ গ্রামে এলেন। সবাই যখন পালাচ্ছে, তখন এক বৃদ্ধা তাকে আশ্রয় দিলেন। ভিখারি বললেন, "আমি নিয়ানকে তাড়ানোর উপায় জানি।"

রাতে নিয়ান যখন গ্রামে ঢুকল, সে দেখল বৃদ্ধার ঘরের দরজা লাল কাগজে মোড়ানো এবং ভেতরে উজ্জ্বল আলো জ্বলছে। নিয়ান একটু থমকে গেল। হঠাৎ ভিখারিটি বাজি ফাটাতে শুরু করলেন, যার শব্দে নিয়ান ভয় পেয়ে গেল। দেখা গেল, নিয়ান তিনটি জিনিসকে ভয় পায়—লাল রঙ, আগুন এবং বিকট শব্দ। নিয়ান ভয়ে পালিয়ে গেল।

পরদিন গ্রামবাসীরা ফিরে এসে দেখল গ্রাম অক্ষত। সেই থেকে প্রতি নববর্ষে চীনারা লাল কাপড় পরে, লাল লণ্ঠন ঝুলায় এবং প্রচুর আতশবাজি ফাটায়, যাতে নিয়ান আর ফিরে না আসে। এভাবেই শুরু হলো চাইনিজ নিউ ইয়ার উৎসব।`
    },
    {
        id: 5,
        title: "চাঁদের দেবী চাং'ই (Chang'e to the Moon)",
        image: "https://images.unsplash.com/photo-1532693322450-2cb5c511067d?q=80&w=800&auto=format&fit=crop",
        desc: "অমরত্বের ঔষধ এবং চাঁদে বসবাসকারী এক দেবীর কাহিনী।",
        fullStory: `অনেক কাল আগে আকাশে দশটি সূর্য ছিল। তাদের তাপে পৃথিবী পুড়ে যাচ্ছিল। তখন 'হাউ ই' নামের এক বীর তীরন্দাজ তার জাদুকরী ধনুক দিয়ে নয়টি সূর্যকে ধ্বংস করে পৃথিবীকে বাঁচান। পুরস্কার হিসেবে স্বর্গের রানী তাকে এক বোতল অমৃত (অমর হওয়ার ঔষধ) দেন। কিন্তু হাউ ই তার স্ত্রী 'চাং'ই'-কে খুব ভালোবাসতেন, তাই তিনি একা অমর হয়ে স্বর্গে যেতে চাইলেন না। তিনি ঔষধটি স্ত্রীর কাছে গচ্ছিত রাখলেন।

হাউ ই-এর এক ছাত্র, পেং মেং, এই ঔষধ চুরি করতে চাইল। একদিন হাউ ই যখন শিকারে গেলেন, পেং মেং তরবারি নিয়ে চাং'ই-কে আক্রমণ করল। উপায় না দেখে চাং'ই নিজেই পুরো ঔষধটি খেয়ে ফেললেন।

সাথে সাথে তার শরীর হালকা হতে শুরু করল। তিনি বাতাসের মতো ভেসে জানাল দিয়ে উড়ে যেতে লাগলেন। উড়তে উড়তে তিনি চাঁদে গিয়ে পৌঁছালেন, কারণ চাঁদই ছিল পৃথিবীর সবচেয়ে কাছের জায়গা, যেখান থেকে তিনি তার স্বামীকে দেখতে পাবেন।

হাউ ই ফিরে এসে সব জানলেন। তিনি চাঁদের দিকে তাকিয়ে দেখলেন তার স্ত্রী সেখানে আছে। সেই থেকে প্রতি বছর অষ্টম পূর্ণিমায় মানুষ চাঁদের পূজা করে এবং মুনকেক খায়, যাতে হাউ ই এবং চাং'ই-এর ভালোবাসা স্মরণ করা যায়।`
    }
];

// PWA Install Prompt Logic
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    console.log("Install prompt saved");
});

// Render Stories
const container = document.getElementById('story-container');
const modal = document.getElementById('story-modal');
const modalImg = document.getElementById('modal-img');
const modalTitle = document.getElementById('modal-title');
const modalText = document.getElementById('modal-text');
const closeBtn = document.querySelector('.close-btn');

stories.forEach(story => {
    const card = document.createElement('div');
    card.classList.add('card');
    card.innerHTML = `
        <img src="${story.image}" alt="${story.title}">
        <div class="card-content">
            <div class="card-title">${story.title}</div>
            <div class="card-desc">${story.desc}</div>
        </div>
    `;
    
    // Click Event: Try to Install -> Then Open Story
    card.addEventListener('click', async () => {
        // Step 1: Trigger Install Prompt
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response: ${outcome}`);
            deferredPrompt = null; // Used once
        }
        
        // Step 2: Open Story (Whether installed or not)
        openStory(story);
    });

    container.appendChild(card);
});

function openStory(story) {
    modalImg.src = story.image;
    modalTitle.innerText = story.title;
    modalText.innerText = story.fullStory;
    modal.style.display = "block";
}

// Close Modal Logic
closeBtn.onclick = () => modal.style.display = "none";
window.onclick = (event) => {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
